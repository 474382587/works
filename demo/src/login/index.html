<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>登录</title>
    <link rel="stylesheet" href="./css/main.css">
    <style>
        body {
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .wrapper {
            flex: 1;
            background-color: rgb(236, 236, 236);
            padding: 50px 80px;
        }

        form>ul {
            box-sizing: border-box;
            margin: 0 auto;
            max-width: 600px;
            padding: 30px 80px;
            background-color: rgb(255, 255, 255);
        }

        form>ul>li {
            height: 50px;
            width: 350px;
            margin: 20px auto;
            text-align: center;
            display: flex;
            justify-content: space-between;
        }

        form>ul>li:first-child {
            border-bottom: 1px solid black;
        }

        form>ul>li>input,
        form span {
            line-height: 50px;
            display: block;
            font-size: 16px;
            padding: 0px 5px;
            flex: 1;
        }

        form input.aleart {
            border-color: red;
        }

        li>button {
            word-spacing: 12px;
            width: 140px;
            margin: 0 auto;
            height: 30px;
            font-size: 16px;
            color: white;
            background-color: rgb(255, 14, 44);
            border-radius: 30px;
            border: none;
            outline: none;
        }

        li>button:active {
            background-color: rgb(211, 39, 59);
            box-shadow: 0 2px #999;
            transform: translateY(2px);
        }

        li>button:hover {
            cursor: pointer;
        }

        div>a+a {
            text-decoration: none;
            color: red;
        }

        input+span:active {
            background-color: #3e8e41;
            box-shadow: 0 2px #666;
            transform: translateY(2px);
        }

        ul>li>input.alert {
            border: 1px solid red;
        }

        li>div {
            display: flex;
            flex: 1;
            justify-content: space-around;
            line-height: 50px;
        }

        label {
            text-align: left;
            flex: 1;
            line-height: 50px;
            /* padding: 0 10px; */
        }
    </style>
</head>

<body>
    <header>
        <nav>
            <a href="./">
                <img src="../../static/img/logo.png" alt="Logo"> 猿计划
            </a>
            <ul>
                <li>
                    <a href="">未读消息</a>
                </li>
                <li>
                    <a href="../../">首页</a>
                </li>
                <li>
                    <a href="">知识体系</a>
                </li>
                <li>
                    <a href="">活动中心</a>
                </li>
                <li>
                    <a href=".././article/">文章</a>
                </li>
                <li class="before-login">
                    <a href="" class="active">登录</a>
                </li>
                <li class="before-login">
                    <a href=".././register/">注册</a>
                </li>
                <li class="after-login hide">
                    <a href="">写文章</a>
                </li>
            </ul>
        </nav>
    </header>
    <div class="wrapper">
        <form class="registerBox">
            <ul>
                <li>
                    <span>欢迎回到猿计划</span>
                </li>
                <li>
                    <input id="tel" type="tel" placeholder="请输入登录手机号码">
                </li>

                <li>
                    <input id="password" type="password" placeholder="6-10位密码，区分大小写，不能使用空格">
                </li>
                <li>
                    <label>
                        <input id="remember" type="checkbox">下次自动登录</label>
                    <div>
                        <a href="#">忘记密码</a>
                        <a href="../register/index.html">立即注册</a>
                    </div>
                </li>
                <li>
                    <button id="submit" type="submit">登 录</button>
                </li>
            </ul>
        </form>
    </div>
    <script src="../../vendor/axios/axios.min.js"></script>
    <script>
        const number = document.getElementById("tel");
        const password = document.getElementById("password");
        const remember = document.getElementById("remember");
        window.onload = function () {
            let cookieArr = document.cookie;
            if (cookieArr !== "") {
                console.log(cookieArr);
                window.location.href = "../../";
            }
        }
        document.addEventListener("submit", (e) => {
            let loginNumber = number.value;
            let loginPassword = password.value;
            let saveCookie = document.getElementById("remember").checked;
            axios({
                method: 'post',
                url: 'http://www.ftusix.com/static/data/login.php',
                data: {
                    mobile: loginNumber,
                    pwd: loginPassword,
                }
            }).then(function (response) {
                console.log(response);
                if (response.data.status === 0) {
                    alert(response.data.info);
                }
                else {
                    let token = response.data.data[0].token;
                    let userId = response.data.data[0].user_id;
                    if (saveCookie) {
                        console.log("Use Cookie" + " token = " + token + " userid = " + userId)
                        setCookie('user_id', userId);
                        setCookie('token', token);
                    }
                    else {
                        console.log("Use localstorage")
                        document.cookie = 'user_id' + "=" + encodeURI(userId) + ";path=" + relPathToAbs("../../");
                        document.cookie = 'token' + "=" + encodeURI(token) + ";path=" + relPathToAbs("../../");
                    }
                    window.location.reload();
                }


            }).catch(function (error) {
                console.log(error);
            });
            e.preventDefault();
        });

        //写入Cookie
        function setCookie(name, value) {
            var Days = 7;
            var exp = new Date();
            exp.setTime(exp.getTime() + Days * 24 * 60 * 60 * 1000);
            document.cookie = name + "=" + encodeURI(value) + ";expires=" + exp.toGMTString() + ";path=" + relPathToAbs("../../");
        }


        //relative path
        function relPathToAbs(sRelPath) {
            var nUpLn, sDir = "", sPath = location.pathname.replace(/[^\/]*$/, sRelPath.replace(/(\/|^)(?:\.?\/+)+/g, "$1"));
            for (var nEnd, nStart = 0; nEnd = sPath.indexOf("/../", nStart), nEnd > -1; nStart = nEnd + nUpLn) {
                nUpLn = /^\/(?:\.\.\/)*/.exec(sPath.slice(nEnd))[0].length;
                sDir = (sDir + sPath.substring(nStart, nEnd)).replace(new RegExp("(?:\\\/+[^\\\/]*){0," + ((nUpLn - 1) / 3) + "}$"), "/");
            }
            return sDir + sPath.substr(nStart);
        }

    </script>
</body>

</html>