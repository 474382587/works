<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>我是精明的小卖家</title>
</head>

<body>
    <div id="options">
        <!-- 地区 -->
        <div>
            <label>
                <input type="checkbox" name="region" value="全部" class="all"> 全部地区
            </label>
            <label>
                <input type="checkbox" name="region" value="华东" class="single"> 华东
            </label>
            <label>
                <input type="checkbox" name="region" value="华南" class="single"> 华南
            </label>
            <label>
                <input type="checkbox" name="region" value="华北" class="single"> 华北
            </label>
        </div>

        <br>

        <!-- 商品种类 -->
        <div>
            <label>
                <input type="checkbox" name="product" value="全部" class="all"> 全部商品
            </label>
            <label>
                <input type="checkbox" name="product" value="手机" class="single"> 手机
            </label>
            <label>
                <input type="checkbox" name="product" value="笔记本" class="single"> 笔记本
            </label>
            <label>
                <input type="checkbox" name="product" value="智能音箱" class="single"> 智能音箱
            </label>
        </div>
    </div>
    <div id="table-wrapper">

    </div>

    <script>
        const display_table = document.getElementById("table-wrapper");
        let sourceData = [{
            product: "手机",
            region: "华东",
            sale: [120, 100, 140, 160, 180, 185, 190, 210, 230, 245, 255, 270]
        }, {
            product: "手机",
            region: "华北",
            sale: [80, 70, 90, 110, 130, 145, 150, 160, 170, 185, 190, 200]
        }, {
            product: "手机",
            region: "华南",
            sale: [220, 200, 240, 250, 260, 270, 280, 295, 310, 335, 355, 380]
        }, {
            product: "笔记本",
            region: "华东",
            sale: [50, 60, 80, 110, 30, 20, 70, 30, 420, 30, 20, 20]
        }, {
            product: "笔记本",
            region: "华北",
            sale: [30, 35, 50, 70, 20, 15, 30, 50, 710, 130, 20, 20]
        }, {
            product: "笔记本",
            region: "华南",
            sale: [80, 120, 130, 140, 70, 75, 120, 90, 550, 120, 110, 100]
        }, {
            product: "智能音箱",
            region: "华东",
            sale: [10, 30, 4, 5, 6, 5, 4, 5, 6, 5, 5, 25]
        }, {
            product: "智能音箱",
            region: "华北",
            sale: [15, 50, 15, 15, 12, 11, 11, 12, 12, 14, 12, 40]
        }, {
            product: "智能音箱",
            region: "华南",
            sale: [10, 40, 10, 6, 5, 6, 8, 6, 6, 6, 7, 26]
        }];

        const checkall = document.querySelectorAll("input[value='全部']");
        console.log(checkall);

        checkall.forEach(e => {
            e.addEventListener("input", e => {
                let checked = e.target.checked;
                if (checked) {
                    document.querySelectorAll(`input[name="${e.target.name}"]`).forEach(e => {
                        e.checked = true;
                    });
                }
                e.target.checked = true;
            })
        });

        const checkboxes = document.querySelectorAll("input.single");
        checkboxes.forEach(e => {
            e.addEventListener("input", el => {
                //判断是否全部已经被选中
                if ([...document.querySelectorAll(`input.single[name="${el.target.name}"]`)].every(e => {
                    return e.checked === true;
                })) {
                    document.querySelector(`input[name="${el.target.name}"]`).checked = true;
                }
                else {
                    document.querySelector(`input[name="${el.target.name}"]`).checked = false;
                }
                //判断是否全部都没被选中
                if ([...document.querySelectorAll(`input.single[name="${el.target.name}"]`)].every(e => {
                    return !e.checked === true;
                })) {
                    el.target.checked = true;
                }
            });
        });





        function renderTable() {
            let region = [...select_region.options].filter(e => e.selected === true);
            let product = select_product.value;
            console.dir(region);

            let list = filterData(sourceData, product, region);
        }

        function filterData(data, product, region) {
            if (product === "" && region === "") {
                return data;
            }
            if (product === "") {
                return filterByRegion(data, region);
            }
            if (region === "") {
                return filterByProduct(data, product)
            }
            return filterByProduct(filterByRegion(data, region), product);
        }

        //filter by Product 
        console.log(filterByProduct(sourceData, ['手机', '笔记本']));
        
        function filterByProduct(data, productList) {
            let result = [];
            productList.forEach(e => {
                result.push(data.filter(el => {
                    return el.product === e;
                }));
            });
            result = [].concat(...result)
            return result;
        }
        // filter by region
        console.log(filterByRegion(sourceData, ['华北', '华南']));
        function filterByRegion(data, regionList) {
            let result = [];
            regionList.forEach(e => {
                result.push(data.filter(el => {
                    return el.region === e;
                }));
            });
            result = [].concat(...result)
            return result;
        }






        //create table 
        function createTable(data) {
            let newTable = document.createElement('table');
            newTable.innerHTML = `
        <tr>
            <th>商品</th>
            <th>地区</th>
            <th>1月</th>
            <th>2月</th>
            <th>3月</th>
            <th>4月</th>
            <th>5月</th>
            <th>6月</th>
            <th>7月</th>
            <th>8月</th>
            <th>9月</th>
            <th>10月</th>
            <th>11月</th>
            <th>12月</th>
        </tr>`;
            data.forEach((e, index) => {
                let sale = e.sale;
                let rowContent = `
        <tr>
            <td>${e.product}</td>
            <td>${e.region}</td>
            <td>${sale[0]}</td>
            <td>${sale[1]}</td>
            <td>${sale[2]}</td>
            <td>${sale[3]}</td>
            <td>${sale[4]}</td>
            <td>${sale[5]}</td>
            <td>${sale[6]}</td>
            <td>${sale[7]}</td>
            <td>${sale[8]}</td>
            <td>${sale[9]}</td>
            <td>${sale[10]}</td>
            <td>${sale[11]}</td>
        </tr>`;
                newTable.innerHTML += rowContent;
            });
            return newTable;
        }





    </script>
    <!-- <script src="main.js"></script> -->
</body>

</html>