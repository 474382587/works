<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Restaurant</title>
</head>

<body>
  <script src="./restaurant.js"></script>
  <script src="./staff.js"></script>
  <script src="./waiter.js"></script>
  <script src="./cook.js"></script>
  <script src="./customer.js"></script>
  <script src="./dish.js"></script>
  <script>
    let dataset = [
      {
        name: '11',
        time: 5
      },
      {
        name: '22',
        time: 7
      },
      {
        name: '33',
        time: 8
      },
    ]

    let ready = [];
    let onTable = [];
    let eating = false;
    let available = true;
    let p = Promise.resolve('Start')
    for (let i = 0; i < 3; i++) {
    }


    // dataset.forEach((e, index) => {
    //   p = p.then(el => {
    //     if (index > 0) {
    //       console.log(el)
    //       ready.push({
    //         name: el.name,
    //         time: el.time
    //       })
    //       // eat(false)
    //       pass(false)
    //       console.log("call pass");
    //     }
    //     return new Promise(resolve => {
    //       // console.log("开始做 " + e.name);
    //       setTimeout(() => {
    //         console.log("做完了 " + e.name);
    //         resolve(e)
    //       }, e.time * 1000);
    //     })
    //   })
    // })
    // p.then(el => {
    //   ready.push({
    //     name: el.name,
    //     time: el.time,
    //     lastOne: true
    //   })
    //   pass(false)
    // })

    // function pass(moving) {
    //   if (available || moving) {
    //     available = false
    //     let p = new Promise(resolve => {
    //       setTimeout(() => {
    //         resolve(ready[0])
    //       }, 500)
    //     }).then(e => {
    //       onTable.push(e)
    //       console.log("传到桌子");
    //       eat(false)
    //       ready.shift()
    //       return e.lastOne
    //     }).then(e => {
    //       let p
    //       if (e) {
    //         console.log("准备收钱");
    //       }
    //       else {
    //         p = new Promise(resolve => {
    //           setTimeout(() => {
    //             resolve(ready[0])
    //           }, 500)
    //         })
    //         p.then(e => {
    //           if (ready.length > 0) {
    //             pass(true)
    //           }
    //           else {
    //             available = true
    //           }
    //         })
    //       }
    //     })
    //   }
    // }


    // function eat(onEating) {
    //   if (!eating || onEating) {
    //     eating = true
    //     console.log("开始吃 " + onTable[0].name)
    //     let p = new Promise(resolve => {
    //       setTimeout(() => {
    //         resolve(onTable[0])
    //       }, 3000);
    //     })
    //     p.then((e) => {
    //       console.log("吃完了 " + e.name)
    //       onTable.shift()
    //       if (onTable.length > 0) {
    //         eat(true)
    //       }
    //       else {
    //         eating = false;
    //         if (e.lastOne) {
    //           console.log("吃饱付账");
    //         }
    //         else {
    //           console.log("没东西吃了目前")
    //         }
    //       }
    //     })
    //   }
    // }


  </script>

</body>

</html>